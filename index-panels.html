<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal App Template v0.25</title>
    
    <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« -->
    <link rel="stylesheet" href="src/custom/styles.css">
    <link rel="stylesheet" href="src/custom/styles-responsive.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- ã‚«ã‚¹ã‚¿ãƒ è¨­å®š -->
    <script type="module" src="src/custom/app-config.js"></script>
</head>
<body>
    <div id="app">
        <div class="panels-container">
            <!-- ãƒ‘ãƒãƒ«1: ãƒ¡ã‚¤ãƒ³ -->
            <div class="panel" data-panel-id="main">
                <div class="panel-header">
                    <span class="panel-number">[1]</span>
                    <span class="panel-title">ãƒ¡ã‚¤ãƒ³</span>
                </div>
                <div class="panel-body">
                    <h1>ğŸ“Š Universal App Template <span style="font-size: 0.7em; color: #666;">v0.25</span></h1>
                    
                    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
                    <div id="loginScreen" class="auth-section">
                        <h3>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³</h3>
                        <p>Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ãƒ»åŒæœŸã§ãã¾ã™</p>
                        <button id="loginBtn" onclick="handleGoogleLogin()" class="btn btn-primary">
                            <span>ğŸ”‘ Googleã§ãƒ­ã‚°ã‚¤ãƒ³</span>
                        </button>
                    </div>
                    
                    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”»é¢ -->
                    <div id="userScreen" style="display: none;">
                        <div class="user-info">
                            <span>ğŸ‘¤ ãƒ­ã‚°ã‚¤ãƒ³ä¸­: <span id="userName"></span></span>
                            <button class="btn logout-button" onclick="handleLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                        </div>
                        
                        <div id="main-content">
                            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ãƒ‘ãƒãƒ«2: ãƒ‡ãƒ¼ã‚¿ -->
            <div class="panel" data-panel-id="data">
                <div class="panel-header">
                    <span class="panel-number">[2]</span>
                    <span class="panel-title">ãƒ‡ãƒ¼ã‚¿</span>
                </div>
                <div class="panel-body">
                    <div id="data-content">
                        <h3>ğŸ“ˆ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h3>
                        <div class="data-area" id="dataDisplay">
                            ãƒ‡ãƒ¼ã‚¿è¡¨ç¤ºã‚¨ãƒªã‚¢
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ãƒ‘ãƒãƒ«3: è¨­å®š -->
            <div class="panel" data-panel-id="settings">
                <div class="panel-header">
                    <span class="panel-number">[3]</span>
                    <span class="panel-title">è¨­å®š</span>
                </div>
                <div class="panel-body">
                    <div id="settings-content">
                        <h3>âš™ï¸ ã‚¢ãƒ—ãƒªè¨­å®š</h3>
                        <div class="settings-area">
                            <p>è¨­å®šé …ç›®ã‚’ã“ã“ã«é…ç½®</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ãƒ‘ãƒãƒ«4: ãƒ„ãƒ¼ãƒ«ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰ -->
            <div class="panel collapsed" data-panel-id="tools">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-number">[4]</span>
                    <span class="panel-title">ãƒ„ãƒ¼ãƒ«</span>
                    <button class="panel-toggle">â–¶</button>
                </div>
                <div class="panel-body hidden">
                    <div id="tools-content">
                        <h3>ğŸ› ï¸ ãƒ„ãƒ¼ãƒ«</h3>
                        <div class="btn-group">
                            <button onclick="checkFirebase()" class="btn">Firebaseæ¥ç¶šç¢ºèª</button>
                            <button onclick="checkDataStructure()" class="btn">ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèª</button>
                            <button onclick="testDataSave()" class="btn">ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆ</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ãƒ‘ãƒãƒ«5: ãƒ‡ãƒãƒƒã‚°ï¼ˆæŠ˜ã‚ŠãŸãŸã¿ï¼‰ -->
            <div class="panel collapsed panel-debug" data-panel-id="debug">
                <div class="panel-header" onclick="togglePanel(this)">
                    <span class="panel-number">[5]</span>
                    <span class="panel-title">ãƒ‡ãƒãƒƒã‚°</span>
                    <button class="panel-toggle">â–¶</button>
                </div>
                <div class="panel-body hidden">
                    <div id="debug-content">
                        <h3>ğŸ› ãƒ‡ãƒãƒƒã‚°</h3>
                        <div class="btn-group">
                            <button onclick="toggleDebugConsole()" class="btn">ã‚³ãƒ³ã‚½ãƒ¼ãƒ«è¡¨ç¤º</button>
                            <button onclick="checkLoginIssues()" class="btn">ãƒ­ã‚°ã‚¤ãƒ³è¨ºæ–­</button>
                            <button onclick="forceAuthCheck()" class="btn">èªè¨¼çŠ¶æ…‹ç¢ºèª</button>
                        </div>
                        <div id="debugConsole" style="margin-top: 10px; padding: 10px; background: #f0f0f0; border-radius: 5px; font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; display: none;">
                            <h4>ğŸ› ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«</h4>
                            <div id="debugOutput"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Firebaseè¨­å®š
        const firebaseConfig = {
            apiKey: "AIzaSyA5PXKChizYDCXF_GJ4KL6Ylq9K5hCPXWE",
            authDomain: "shares-b1b97.firebaseapp.com",
            projectId: "shares-b1b97",
            storageBucket: "shares-b1b97.appspot.com",
            messagingSenderId: "1050119774327",
            appId: "1:1050119774327:web:dc603e4cf32c1c652798ec",
            databaseURL: "https://shares-b1b97-default-rtdb.firebaseio.com"
        };
        
        // FirebaseåˆæœŸåŒ–
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        
        // ãƒ‘ãƒãƒ«åˆ‡ã‚Šæ›¿ãˆ
        function togglePanel(header) {
            const panel = header.parentElement;
            const body = panel.querySelector('.panel-body');
            const toggle = header.querySelector('.panel-toggle');
            
            panel.classList.toggle('collapsed');
            body.classList.toggle('hidden');
            toggle.textContent = panel.classList.contains('collapsed') ? 'â–¶' : 'â–¼';
        }
        
        // ãƒ‡ãƒãƒƒã‚°ã‚³ãƒ³ã‚½ãƒ¼ãƒ«è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleDebugConsole() {
            const console = document.getElementById('debugConsole');
            console.style.display = console.style.display === 'none' ? 'block' : 'none';
        }
        
        // ãƒ­ã‚°å‡ºåŠ›
        function log(message) {
            const debugOutput = document.getElementById('debugOutput');
            if (debugOutput) {
                const timestamp = new Date().toLocaleTimeString();
                debugOutput.innerHTML += `[${timestamp}] ${message}<br>`;
                debugOutput.scrollTop = debugOutput.scrollHeight;
            }
            console.log(message);
        }
        
        // Googleãƒ­ã‚°ã‚¤ãƒ³
        async function handleGoogleLogin() {
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const result = await auth.signInWithPopup(provider);
                log(`âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ: ${result.user.displayName}`);
            } catch (error) {
                log(`âŒ ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        async function handleLogout() {
            try {
                await auth.signOut();
                log('âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæˆåŠŸ');
            } catch (error) {
                log(`âŒ ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // èªè¨¼çŠ¶æ…‹ç›£è¦–
        auth.onAuthStateChanged((user) => {
            const loginScreen = document.getElementById('loginScreen');
            const userScreen = document.getElementById('userScreen');
            const userName = document.getElementById('userName');
            
            if (user) {
                loginScreen.style.display = 'none';
                userScreen.style.display = 'block';
                userName.textContent = user.displayName || user.email;
                log(`ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼: ${user.displayName}`);
            } else {
                loginScreen.style.display = 'block';
                userScreen.style.display = 'none';
                log('ğŸ‘¤ æœªèªè¨¼çŠ¶æ…‹');
            }
        });
        
        // Firebaseæ¥ç¶šç¢ºèª
        function checkFirebase() {
            log('ğŸ” Firebaseæ¥ç¶šç¢ºèªä¸­...');
            if (firebase.apps.length > 0) {
                log('âœ… Firebaseæ¥ç¶š: æ­£å¸¸');
            } else {
                log('âŒ Firebaseæ¥ç¶š: å¤±æ•—');
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèª
        async function checkDataStructure() {
            log('ğŸ” ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèªä¸­...');
            try {
                const user = auth.currentUser;
                if (!user) {
                    log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
                    return;
                }
                
                const snapshot = await database.ref(`users/${user.uid}`).once('value');
                const data = snapshot.val();
                log(`ğŸ“Š ãƒ‡ãƒ¼ã‚¿æ§‹é€ : ${JSON.stringify(data, null, 2)}`);
            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆ
        async function testDataSave() {
            log('ğŸ” ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆä¸­...');
            try {
                const user = auth.currentUser;
                if (!user) {
                    log('âŒ ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™');
                    return;
                }
                
                const testData = {
                    timestamp: Date.now(),
                    message: 'ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿',
                    user: user.displayName
                };
                
                await database.ref(`users/${user.uid}/test`).push(testData);
                log('âœ… ãƒ‡ãƒ¼ã‚¿ä¿å­˜æˆåŠŸ');
            } catch (error) {
                log(`âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ãƒ­ã‚°ã‚¤ãƒ³å•é¡Œè¨ºæ–­
        function checkLoginIssues() {
            log('âš ï¸ ãƒ­ã‚°ã‚¤ãƒ³å•é¡Œè¨ºæ–­é–‹å§‹...');
            
            // ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãƒã‚§ãƒƒã‚¯
            const protocol = window.location.protocol;
            log(`ğŸŒ ãƒ—ãƒ­ãƒˆã‚³ãƒ«: ${protocol}`);
            
            if (protocol === 'file:') {
                log('âŒ file://ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã¯Googleèªè¨¼ãŒå‹•ä½œã—ã¾ã›ã‚“');
                log('âœ… è§£æ±ºæ–¹æ³•: HTTPã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹');
            } else {
                log('âœ… ãƒ—ãƒ­ãƒˆã‚³ãƒ«: æ­£å¸¸');
            }
            
            // Cookieãƒã‚§ãƒƒã‚¯
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                log('âœ… LocalStorage: æ­£å¸¸');
            } catch (e) {
                log('âŒ LocalStorage: ç„¡åŠ¹');
            }
            
            log('âš ï¸ è¨ºæ–­å®Œäº†');
        }
        
        // èªè¨¼çŠ¶æ…‹å¼·åˆ¶ç¢ºèª
        function forceAuthCheck() {
            log('ğŸ” èªè¨¼çŠ¶æ…‹ç¢ºèªä¸­...');
            const user = auth.currentUser;
            if (user) {
                log(`âœ… ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿: ${user.displayName}`);
            } else {
                log('âŒ æœªãƒ­ã‚°ã‚¤ãƒ³');
            }
        }
        
        // åˆæœŸåŒ–å®Œäº†
        log('ğŸš€ Universal App Template v0.25 èµ·å‹•å®Œäº†');
        log('ğŸ”¥ FirebaseåˆæœŸåŒ–å®Œäº†');
        log('ğŸ” Googleèªè¨¼æº–å‚™å®Œäº†');
    </script>
</body>
</html>